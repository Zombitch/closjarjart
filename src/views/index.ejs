<%- include('./partials/header.ejs') %>

<body class="h-full bg-gray-50 text-gray-800 ">
  <header class="relative">
    <img src="<%= photoDefault.url %>" alt="Séjour lumineux" class="h-[52vh] w-full object-cover" />
    <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent"></div>
    <div class="absolute inset-x-0 bottom-0 px-6 sm:px-10 lg:px-16 pb-8 text-white">
      <div class="max-w-6xl">
        <span class="inline-flex items-center gap-2 rounded-full bg-white/15 px-3 py-1 text-sm backdrop-blur">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-4 w-4"><path d="M11.28 3.599a.75.75 0 0 1 1.44 0l.528 1.648a3.75 3.75 0 0 0 2.382 2.382l1.648.528a.75.75 0 0 1 0 1.44l-1.648.528a3.75 3.75 0 0 0-2.382 2.382l-.528 1.648a.75.75 0 0 1-1.44 0l-.528-1.648a3.75 3.75 0 0 0-2.382-2.382l-1.648-.528a.75.75 0 0 1 0-1.44l1.648-.528a3.75 3.75 0 0 0 2.382-2.382l.528-1.648Z"/></svg>
          Super hôte • Savigné-sur-Lathan
        </span>
        <h1 class="mt-3 text-3xl sm:text-5xl font-semibold">Loft cocooning avec Sauna — 45m², 1 ch, 1 sde</h1>
        <div class="mt-3 flex flex-wrap items-center gap-3 text-sm sm:text-base">
          <div class="flex items-center gap-1"><span>★ ★ ★ ★ ★</span></div>
          <span class="opacity-60">•</span>
          <div>Jusqu'à <%= config.max_guests %> voyageurs</div>
          <span class="opacity-60">•</span>
          <div>À partir de <span class="font-semibold"><%= config.price %>€</span>/nuit</div>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-6 sm:px-10 lg:px-16 -mt-8 pb-10">
    <!-- Card principal -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Colonne contenu -->
      <section class="lg:col-span-2">
        <%- include('./closjarjart/photos.ejs') %>

        <!-- Description -->
        <%- config.description %>

        <!-- Équipements -->
        <section class="mt-6 p-6 rounded-2xl bg-white shadow-soft">
          <h3 class="text-xl font-semibold">Équipements</h3>
          <div class="mt-4 grid grid-cols-2 sm:grid-cols-3 gap-4 text-sm">
            <div class="flex items-center gap-3"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M4 6h16v12H4z"/><path d="M6 8h12v2H6z"/></svg> Cuisine équipée</div>
            <div class="flex items-center gap-3"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h16v4H4zM4 10h16v10H4z"/></svg> Chauffage </div>
            <div class="flex items-center gap-3"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M3 6h18v12H3z"/><circle cx="8" cy="12" r="2"/><circle cx="16" cy="12" r="2"/></svg> TV + Netflix</div>
            <div class="flex items-center gap-3"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M5 3h14v18H5z"/><path d="M8 7h8v2H8zM8 11h8v2H8zM8 15h5v2H8z"/></svg> Linges</div>
            <div class="flex items-center gap-3"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2 2 7l10 5 10-5z"/><path d="M2 17l10 5 10-5"/></svg> Sauna privatif</div>
          </div>
        </section>

        <!-- Règles & politique -->
        <section class="mt-6 p-6 rounded-2xl bg-white shadow-soft" id="rules">
          <h3 class="text-xl font-semibold">Règles du logement</h3>
          <%- config.rules %>
        </section>

        <!-- Quartier / carte -->
        <section class="mt-6 p-6 rounded-2xl bg-white shadow-soft">
          <h3 class="text-xl font-semibold">Quartier & Accès</h3>
          <p class="mt-2 text-sm leading-7">Idéalement situé à 5 min à pied de la place principale, boulangerie, restaurants et musées. Parking public 50 m.</p>
          <div class="mt-4 aspect-[16/10] w-full overflow-hidden rounded-xl border">
            <iframe title="Carte" width="100%" height="100%" src="https://www.openstreetmap.org/export/embed.html?bbox=0.23294448852539065%2C47.416530908708154%2C0.37628173828125006%2C47.46657077685898&layer=mapnik" loading="lazy"></iframe>
          </div>
        </section>
      </section>

      <!-- Colonne réservation -->
      <aside class="lg:col-span-1 lg:sticky lg:top-6 h-fit md:mt-10">
        <div class="bg-white shadow-soft rounded-2xl p-5">
          <div class="flex items-center">
          <img src="/static/closjarjart_min.png" alt="Logo Closjarjart" class="h-30 w-auto m-auto">
          </div>
          <div class="flex items-center text-center justify-between">
            <div class="m-auto"><span class="text-2xl font-semibold">€<span id="pricePerNight"><%= config.price %></span></span> <span class="text-sm opacity-70">/ nuit</span></div>
          </div>
          <form id="bookingForm" class="mt-4 grid gap-3" onsubmit="event.preventDefault(); submitBooking();">
            <input type="hidden" id="_csrf" name="_csrf" value="<%= csrfToken %>">
            <label class="text-sm">Dates</label>
            <div class="grid grid-cols-2 gap-2">
              <input type="text" id="dateStart" class="rounded-lg border px-3 py-2 cursor-pointer" placeholder="JJ/MM/AAAA" autocomplete="off" required />
              <input id="dateStartISO" name="dateStart" type="hidden" />
              <input type="text" id="dateEnd" class="rounded-lg border px-3 py-2 cursor-pointer" placeholder="JJ/MM/AAAA" autocomplete="off" required />
              <input id="dateEndISO" name="dateEnd" type="hidden" />
            </div>
            <div id="picker" class="hidden z-50 bg-white border rounded-xl shadow-soft p-3 w-full select-none">
              <div class="flex items-center justify-between mb-2">
                <button id="prevBtn" class="px-2 py-1 rounded hover:bg-gray-100"><</button>
                <div id="monthLabel" class="font-medium"></div>
                <button id="nextBtn" class="px-2 py-1 rounded hover:bg-gray-100">></button>
              </div>
              <div class="cal-grid text-xs font-medium text-gray-500 mb-1 text-center">
                <div>Lu</div><div>Ma</div><div>Me</div><div>Je</div><div>Ve</div><div>Sa</div><div>Di</div>
              </div>
              <div id="cal" class="cal-grid"></div>
              <div id="hint" class="mt-2 text-[11px] text-gray-500"></div>
            </div>
            <label class="text-sm">Nom</label>
             <div class="flex items-center gap-2">
              <input value="" id="lastname" name="lastname" type="text" class="w-full text-center rounded-lg border px-2 py-2" placeholder="Nom" autocomplete="off" required/>
            </div>
            <label class="text-sm">Prénom</label>
             <div class="flex items-center gap-2">
              <input value="" id="firstname" name="firstname" type="text" class="w-full text-center rounded-lg border px-2 py-2" placeholder="Prénom" autocomplete="off" required/>
            </div>
            <label class="text-sm">Email</label>
             <div class="flex items-center gap-2">
              <input value="" id="email" name="email" type="email" class="w-full text-center rounded-lg border px-2 py-2" placeholder="Email" autocomplete="off" required/>
            </div>
            <label class="text-sm">Téléphone</label>
             <div class="flex items-center gap-2">
              <input value="" id="tel" name="tel" type="tel" pattern="[0-9]{2}[.\- ]?[0-9]{2}[.\- ]?[0-9]{2}[.\- ]?[0-9]{2}[.\- ]?[0-9]{2}" class="w-full text-center rounded-lg border px-2 py-2" placeholder=" Téléphone" autocomplete="off" required/>
            </div>
            <label class="text-sm">Voyageurs</label>
            <div class="flex items-center gap-2">
              <button type="button" class="w-9 h-9 rounded-lg border" onclick="stepGuests(-1)">−</button>
              <input id="guests" type="number" min="1" max="<%= config.max_guests %>" value="2" class="w-14 text-center rounded-lg border px-2 py-2" />
              <button type="button" class="w-9 h-9 rounded-lg border" onclick="stepGuests(1)">+</button>
              <span class="text-xs opacity-70 ml-auto">max <%= config.max_guests %></span>
            </div>
            <div class="mt-2 space-y-1 text-sm">
              <div class="flex justify-between"><span>Nuits</span><span id="nights">0</span></div>
              <div class="flex justify-between"><span>Frais de gestion</span><span id="fees_management">0</span></div>
              <% if(config.cleaning_fees > 0){ %><div class="flex justify-between"><span>Sous‑total</span><span>€<span id="subtotal">0</span></span></div><% } %>
              <% if(config.cleaning_fees > 0){ %><div class="flex justify-between"><span>Frais de ménage</span><span>€<span id="cleaning"><%= config.cleaning_fees %></span></span></div><% } %>
              <hr>
              <div class="flex justify-between font-semibold text-lg"><span>Total</span><span>€<span id="total">0</span></span></div>
            </div>
            <button class="mt-3 w-full rounded-xl bg-cyan-600 text-white py-3 font-medium hover:bg-cyan-700 transition" type="submit">Réserver maintenant</button>
            <p class="text-xs text-center opacity-70">Vous ne serez pas encore débité.</p>
          </form>
        </div>

        <!-- Points clés -->
        <div class="mt-6 grid gap-3">
          <div class="bg-white rounded-2xl p-4 shadow-soft">
            <div class="font-semibold">Points santé & sécurité</div>
            <ul class="mt-2 text-sm list-disc pl-5 space-y-1">
              <li>Détecteurs de fumée & CO²</li>
            </ul>
          </div>
        </div>
      </aside>
    </div>

    <!-- FAQ -->
    <section class="mt-8 mb-16 p-6 rounded-2xl bg-white shadow-soft" id="faq">
      <h3 class="text-xl font-semibold">FAQ</h3>
      <div class="mt-4 divide-y">
        <details class="py-3 group">
          <summary class="cursor-pointer flex items-center justify-between font-medium">Les draps et serviettes sont‑ils fournis ?<span class="opacity-60">+</span></summary>
          <p class="mt-2 text-sm">Oui, tout le linge de lit et de toilette est fourni.</p>
        </details>
      </div>
    </section>
  </main>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-15 left-1/2 -translate-x-1/2 text-white px-4 py-3 rounded-full shadow-lg hidden">Demande envoyée ✔</div>
  <span class="bg-red-600 bg-green-600 hidden"></span>

  <%- include('./partials/footer.ejs') %>
</body>
<script type="text/javascript">
  setConfig(JSON.parse('<%- blockedDate %>'), JSON.parse('<%- config.max_guests %>'))
</script>
</html>
